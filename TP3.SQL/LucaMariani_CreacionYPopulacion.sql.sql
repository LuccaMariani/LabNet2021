/*- Trabajo Practico Final SQL - Mariani Juan Luca -*/

USE [master]
GO
IF EXISTS (SELECT * FROM sys.databases d WHERE d.[name]='AcademiaCursos')
BEGIN
	ALTER DATABASE AcademiaCursos SET  SINGLE_USER WITH ROLLBACK IMMEDIATE
END
GO
USE [master]
GO
IF EXISTS (SELECT * FROM sys.databases d WHERE d.[name]='AcademiaCursos')
BEGIN
	DROP DATABASE AcademiaCursos
END

GO
CREATE DATABASE AcademiaCursos--PracticaSQL
GO
USE AcademiaCursos
GO
CREATE SCHEMA ACADEMIA 
GO

-- Tablas
create table ACADEMIA.TRABAJADOR (ID INT primary key, CUIT INT NOT NULL, EMPRESA_NOMBRE VARCHAR(50) NOT NULL, EMPRESA_TELEFONO INT NOT NULL, EMPRESA_DIRECCION VARCHAR(256) NOT NULL);
create table ACADEMIA.ALUMNO (ID INT primary key, ALUMNO_DNI INT NOT NULL, ALUMNO_DIRECCION VARCHAR(256) NOT NULL, ALUMNO_NOMBRE VARCHAR(50) NOT NULL, ALUMNO_APELLIDO VARCHAR(50) NOT NULL, ALUMNO_TELEFONO INT NOT NULL, ALUMNO_FECHA_NACIMIENTO DATE NOT NULL, TRABAJADOR_ID INT);
create table ACADEMIA.DOCENTE (ID INT primary key, DOCENTE_DNI INT NOT NULL, DOCENTE_DIRECCION VARCHAR(256) NOT NULL, DOCENTE_NOMBRE VARCHAR(50) NOT NULL,DOCENTE_APELLIDO VARCHAR(50) NOT NULL,DOCENTE_TELEFONO INT NOT NULL, DOCENTE_FECHA_NACIMIENTO DATE NOT NULL);
create table ACADEMIA.CURSO(ID VARCHAR(10) primary key, HORAS_DURACION DECIMAL (10,2) NOT NULL, TITULO VARCHAR(50) NOT NULL, FECHA_INICIO DATE NOT NULL, FECHA_FIN DATE NOT NULL, DOCENTE_ID INT NOT NULL);

--create table ACADEMIA.REGISTRO (ID INT primary key, ID_CURSO VARCHAR(10) NOT NULL, DOCENTE_DNI INT NOT NULL, DOCENTE_APELLIDO VARCHAR(50) NOT NULL, FECHA_INICIO DATE NOT NULL, FECHA_FIN DATE NOT NULL,ALUMNO_DNI INT NOT NULL, ALUMNO_NOMBRE VARCHAR(50) NOT NULL, ALUMNOO_APELLIDO VARCHAR(50) NOT NULL, ALUMNO_NOTA INT NOT NULL);
create table ACADEMIA.REGISTRO (ID INT primary key, CURSO_ID VARCHAR(10) NOT NULL, DOCENTE_ID INT NOT NULL,ALUMNO_ID INT NOT NULL,  ALUMNO_NOTA INT NOT NULL);


-- Relaciones
alter table ACADEMIA.ALUMNO add constraint ALUMNO_TRABAJADOR foreign key (TRABAJADOR_ID) references ACADEMIA.TRABAJADOR;

alter table ACADEMIA.CURSO add constraint CURSO_DOCENTE foreign key (DOCENTE_ID) references ACADEMIA.DOCENTE;

alter table ACADEMIA.REGISTRO add constraint REGISTRO_ALUMNO foreign key (ALUMNO_ID) references ACADEMIA.ALUMNO;
alter table ACADEMIA.REGISTRO add constraint REGISTRO_DOCENTE foreign key (DOCENTE_ID) references ACADEMIA.DOCENTE;
alter table ACADEMIA.REGISTRO add constraint REGISTRO_CURSO foreign key (CURSO_ID) references ACADEMIA.CURSO;


-- DATOS
-- Trabajos
insert into ACADEMIA.TRABAJADOR VALUES (1, 123, 'Empresa Luca', 1511111111, 'Direccion de la Empresa Luca');
insert into ACADEMIA.TRABAJADOR VALUES (2, 345, 'Empresa Flor', 1522222222, 'Direccion de la Empresa Flor');
insert into ACADEMIA.TRABAJADOR VALUES (3, 678, 'Empresa Thomy', 1533333333, 'Direccion de la Empresa Thomy');
insert into ACADEMIA.TRABAJADOR VALUES (4, 910, 'Empresa Fran', 1544444444, 'Direccion de la Empresa Fran');

-- Docentes
insert into ACADEMIA.DOCENTE VALUES (10, 20123456, 'Direccion Docente Uno', 'Juan', 'Perez', 1500001111,'2000-01-01');
insert into ACADEMIA.DOCENTE VALUES (11, 20234567, 'Direccion Docente Dos', 'Jose', 'Martinez', 1500002222,'2000-02-02');
insert into ACADEMIA.DOCENTE VALUES (12, 30123456, 'Direccion Docente Tres', 'Mariano', 'Gonsalez', 1500003333,'2000-03-03');
insert into ACADEMIA.DOCENTE VALUES (13, 30234567, 'Direccion Docente Cuatro', 'Florencia', 'Rodriguez', 1500004444,'2000-03-03');

-- Cursos
insert into ACADEMIA.CURSO VALUES ('C_ANALISTA', 40.5, 'Analista en Sistemas', '2015-02-02', '2015-08-10', 10);
insert into ACADEMIA.CURSO VALUES ('C_SISTEMAS', 20.5, 'Analista en Redes', '2014-01-01', '2015-06-23', 11);

-- Alumnos
insert into ACADEMIA.ALUMNO VALUES (1, 31012345, 'Direccion Julio','Laura', 'Lopez', 1501, '2000-11-17', NULL);
insert into ACADEMIA.ALUMNO VALUES (2, 32012345, 'Direccion Mariano','Mariano', 'Gutierrez',1502, '2000-12-23', 1);
insert into ACADEMIA.ALUMNO VALUES (3, 33012345, 'Direccion Pedro','Pedro', 'Martinez',1502, '2001-08-05', 3);
insert into ACADEMIA.ALUMNO VALUES (4, 34012345, 'Direccion Federico','Federico', 'Gomez',1502, '2002-03-19', 4);

-- Registro
	--Curso Analistas
insert into ACADEMIA.REGISTRO VALUES (1,'C_ANALISTA', 10,1, 3);
insert into ACADEMIA.REGISTRO VALUES (2,'C_ANALISTA', 10,2, 2);
insert into ACADEMIA.REGISTRO VALUES (3,'C_ANALISTA', 10,2, 5);
insert into ACADEMIA.REGISTRO VALUES (4,'C_ANALISTA', 10,2, 7);
	--Curso Sistemas
insert into ACADEMIA.REGISTRO VALUES (5,'C_SISTEMAS', 11,2, 3);
insert into ACADEMIA.REGISTRO VALUES (6,'C_SISTEMAS', 11,2, 5);
insert into ACADEMIA.REGISTRO VALUES (7,'C_SISTEMAS', 11,1, 2);
insert into ACADEMIA.REGISTRO VALUES (8,'C_SISTEMAS', 11,2, 8);
